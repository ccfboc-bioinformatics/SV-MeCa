//ToDo
// update tardis bind path
// include max ressources 
// include config for alignment
// include profiles for differents environments
// change enable makdup to enable tardis markdup
myConda = '/home/rudel/miniconda3/envs/'
params {

    // General standard
    
    results = "$baseDir/results/52_no_interdup"
    

    // General Custom
    bed = "$baseDir/data/hg19_gap.bed"
    input = "/home/rudel/github/data/hg002_52.bam"
    reference = "$baseDir/data/hs37d5.fa"
    skip_manta = false
    // Breakdancer

    // Delly

    // Lumpy

    // Manta

    // Pindel
    pd_multi = true

    // Tardis
    sonic_file = "$baseDir/data/human_g1k_v37.sonic"
    enable_markdup = true
}



process{
    //executor = 'slurm'
	//queue = 'devel-rh7,smp-rh7,fbz,fbz-exclusive'
    //cache = 'lenient'
    //clusterOptions = '--account=rnkouame --exclusive'
    //queueSize = 50
    
    
    withName: REFERENCE_INDEX {
        conda = "${myConda}/samtools"
        cpus = 1
        memory = {4.GB * task.attempt}
        errorStrategy = 'retry'
        maxRetries = 1
        time = '1h'
    }

    withName: INCLUDE_REGIONS {
        conda = "${myConda}/samtools"
        cpus = 1
        memory = {4.GB * task.attempt}
        errorStrategy = 'retry'
        maxRetries = 1
        time = '1h'
    }

    withName: BAM_INDEX {
        conda = "${myConda}/samtools"
        cpus = 8
        memory = {8.GB * task.attempt}
        errorStrategy = 'retry'
        maxRetries = 1
        time = '1h'
    }
    
    withName: METRICS {
        conda = "${myConda}/align"
        cpus = 1
        memory = {4.GB * task.attempt}
        errorStrategy = 'retry'
        maxRetries = 1
        time = '12h'
    }

    withName: BREAKDANCER {
        conda = "${myConda}/breakdancer"
        cpus = 1
        memory = {4.GB * task.attempt}
        errorStrategy = 'retry'
        maxRetries = 1
        time = '24h'
    }
    withName: MANTA {
        conda = "${myConda}/manta"
        cpus = {6 * task.attempt}
        memory = {8.GB * task.attempt}
        errorStrategy = 'retry'
        maxRetries = 1
        time = '24h'
    }
    withName: LUMPY {
        conda = "${myConda}/lumpy"
        cpus = 4
        memory = {8.GB * task.attempt}
        errorStrategy = 'retry'
        maxRetries = 1
        time = '24h'
    }
    withName: DELLY {
        conda = "${myConda}/delly"
        cpus = 1
        memory = {6.GB * task.attempt}
        errorStrategy = 'retry'
        maxRetries = 1
        time = '24h'
    }
    withName: PINDEL_SINGLE {
        conda = "${myConda}/pindel"
        cpus = {4 * task.attempt}
        memory = {8.GB * task.attempt}
        errorStrategy = 'retry'
        maxRetries = 1
        time = '24h'
    }
    withName: MERGE_PINDEL_SINGLE {
        conda = "${myConda}/samtools"
        cpus = 2
        memory = {4.GB * task.attempt}
        errorStrategy = 'retry'
        maxRetries = 1
        time = '1h'
    }
    withName: TARDIS_PREP {
        conda = "${myConda}/samtools"
        cpus = 8
        memory = {8.GB * task.attempt}
        errorStrategy = 'retry'
        maxRetries = 1
        time = '24h'
    }
    //ToDo binding directories for tardis
    withName: TARDIS {
        container = "$baseDir/bin/tardis_latest.sif"
        containerOptions = "--bind /home/rudel"
        cpus = 8
        memory = {16.GB * task.attempt}
        errorStrategy = 'retry'
        maxRetries = 1
        time = '24h'
    }
    withName: SURVIVOR_MERGE {
        conda = "${myConda}/survivor"
        cpus = 2
        memory = {4.GB * task.attempt}
        errorStrategy = 'retry'
        maxRetries = 1
        time = '24h'
    }
}

singularity {
    enabled = true 
    autMounts = true
    engineOptions = "-d"
}
trace {
    enabled = true
    file = 'trace_52.tsv'
    fields = 'task_id, hash, native_id, name, status, attempt, exit, realtime, cpus, %cpu, memory, %mem, rss, vmem, peak_rss, peak_vmem'
    overwrite = true
}
timeline{
    enabled = true
    file = 'timeline_52.html'
    overwrite = true
}

conda.enabled = true
